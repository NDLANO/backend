name: "Check whether ghGenerate is up to date"
on:
  workflow_dispatch:
    inputs: { }
  push:
    paths:
      - "**/*.mill"
  pull_request:
    paths:
      - "**/*.mill"
jobs:
  gh_generate:
    name: Run ghGenerate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: coursier/cache-action@v6
      - uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: ${{ vars.JAVA_VERSION }}
      - name: Run ghGenerate
        run: ./mill -i _.ghGenerate
      - name: Verify generated files are up to date
        run: |
          if ! git diff --quiet; then
            echo "::error::Generated files are out of date. Please run './mill -i _.ghGenerate' locally and commit the changes."
            echo ""
            git status --short
            git diff --stat
            exit 1
          fi
